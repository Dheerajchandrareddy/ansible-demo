---
- name: Auto Heal Demo
  hosts: autoheal
  gather_facts: no
  tasks:
   - name: Sleep for 3 minutes
     wait_for:
       timeout: 60
     delegate_to: localhost

   - name: Create a directory to keep logs
     file:
       path: /opt/logs_archive
       state: "{{ item }}"
     with_items:
       - absent
       - directory

   - name: Move data from logs directory to archive directory
     synchronize:
       src: /app/logs/{{ item }}
       dest: /opt/logs_archive/{{ item }}
     delegate_to: "{{ inventory_hostname }}"
     with_items:
       - app.logs.1
       - app.logs
     ignore_errors: yes

   - name: Clean the old log files
     file:
       path: /app/logs/{{ item }}
       state: absent
     with_items:
        - app.logs.1
        - app.logs
     ignore_errors: yes
